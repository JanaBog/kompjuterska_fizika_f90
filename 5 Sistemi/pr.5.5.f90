! ============================================================
! Програм: gauss_seidel.f90
! Цел: Решавање на систем A*x = b со методот на Гаус-Зајдел
! ============================================================

program gauss_seidel
    implicit none
    integer, parameter :: n = 2, max_iter = 50
    real(8), parameter :: eps = 1.0d-6
    real(8) :: A(n,n), b(n), x(n), x_old(n)
    real(8) :: sum, error
    integer :: i, j, k

    ! ------------------------------------------------------------
    ! Пример систем:
    !  4x1 - 1x2 = 3
    ! -2x1 + 6x2 = 9
    ! ------------------------------------------------------------
    A = reshape([4.0d0, -1.0d0, &
                -2.0d0,  6.0d0], shape(A))
    b = [3.0d0, 9.0d0]

    ! Почетна претпоставка
    x = 0.0d0

    print *, "-------------------------------------------"
    print *, "Метод на Гаус-Зајдел:"
    print *, "-------------------------------------------"

    do k = 1, max_iter
        x_old = x    ! зачувување на претходната итерација

        do i = 1, n
            sum = 0.0d0

            ! Собери ги сите a_ij * x_j освен за j = i
            do j = 1, n
                if (j /= i) then
                    sum = sum + A(i,j) * x(j)
                end if
            end do

            ! Новата вредност за x_i
            x(i) = (b(i) - sum) / A(i,i)
        end do

        ! Проверка на точноста
        error = maxval(abs(x - x_old))
        print '(a,i2,a,f10.6,a,f10.6,a,f10.6)', &
      "Итерација ", k, ": x1=", x(1), " x2=", x(2), " грешка=", error


        if (error < eps) exit
    end do

    print *, "-------------------------------------------"
    print *, "Решението е:"
    do i = 1, n
        print '(a,i1,a,f10.6)', "x(", i, ") = ", x(i)
    end do
    print *, "-------------------------------------------"

end program gauss_seidel

! ============================================================
! Програм: tridiagonal_solver.f90
! Цел: Решавање на тридијагонален систем A*x = d
!       со метод на Крут/Дулитл
! ============================================================

program tridiagonal_solver
    implicit none
    integer, parameter :: n = 3
    real(8) :: a(n), b(n), c(n), d(n), x(n)
    real(8) :: m
    integer :: i

    ! ------------------------------------------------------------
    ! Влезни податоци за пример:
    !  2x1 + 1x2         = 5
    !  1x1 + 2x2 + 1x3   = 6
    !       1x2 + 2x3    = 5
    ! ------------------------------------------------------------
    a = [2.0d0, 2.0d0, 2.0d0]    ! главна дијагонала
    b = [1.0d0, 1.0d0, 0.0d0]    ! горна дијагонала (последната е 0)
    c = [0.0d0, 1.0d0, 1.0d0]    ! долна дијагонала (првата е 0)
    d = [5.0d0, 6.0d0, 5.0d0]    ! десна страна

    print *, "-------------------------------------------"
    print *, "Pocheten sistem:"
    do i = 1, n
        print '(f6.2,2x,f6.2,2x,f6.2,2x,f6.2)', b(i), a(i), c(i), d(i)
    end do

    ! ============================================================
    ! ФАЗА 1: ЕЛИМИНАЦИЈА НАНАПРЕД
    ! ============================================================
    do i = 2, n
        m = c(i) / a(i-1)
        a(i) = a(i) - m * b(i-1)
        d(i) = d(i) - m * d(i-1)
    end do

    ! ============================================================
    ! ФАЗА 2: ЗАМЕНА НАНАЗАД
    ! ============================================================
    x(n) = d(n) / a(n)
    do i = n-1, 1, -1
        x(i) = (d(i) - b(i)*x(i+1)) / a(i)
    end do

    ! ------------------------------------------------------------
    ! Печатење на резултатот
    ! ------------------------------------------------------------
    print *
    print *, "-------------------------------------------"
    print *, "Reshenie na sistemot:"
    do i = 1, n
        print '(a,i1,a,f8.4)', "x(", i, ") = ", x(i)
    end do

end program tridiagonal_solver
